p_s, t_s, p = {}, [], []
[p_s.__setitem__(n, sum(1 for l in sec.splitlines()[1:] for c in l if c != '.')) for n, sec in enumerate(open("input.txt", "r").read().strip().split('\n\n')) if re.search(r"^(\d+)x(\d+):\s+(.*)$", sec.splitlines()[0]) and t_s.append((int(re.search(r"^(\d+)x(\d+):\s+(.*)$", sec.splitlines()[0]).group(1)), int(re.search(r"^(\d+)x(\d+):\s+(.*)$", sec.splitlines()[0]).group(2)))) and p.append([int(i) for i in re.search(r"^(\d+)x(\d+):\s+(.*)$", sec.splitlines()[0]).group(3).split()])]
print(sum([1 for (x,y), p_u_t in zip(t_s, p) if not (sum([n_p*p_s[i] for i,n_p in enumerate(p_u_t)]) > x*y or sum([n_p for n_p in p_u_t]) > y//3*x//3)]))